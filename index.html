<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosmic Clickers</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #0b0c2a, #2e003e);
    color: white;
    overflow-x: hidden;
  }
  #game-container {
    display: flex;
    flex-direction: row;
    height: 100vh;
  }
  #click-area {
    flex: 3;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #click-button {
    font-size: 4rem;
    padding: 2rem 3rem;
    border-radius: 20px;
    border: none;
    background: #ffcc00;
    cursor: pointer;
    transition: transform 0.1s;
  }
  #shop {
    flex: 1;
    background: rgba(0,0,0,0.3);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }
  .shop-item {
    margin: 1rem 0;
    padding: 1rem;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    cursor: pointer;
  }
  .shop-item:hover {
    background: rgba(255,255,255,0.2);
  }
  #settings {
    position: fixed;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.5);
    padding: 0.5rem;
    border-radius: 10px;
    cursor: pointer;
  }
  #settings-panel {
    position: fixed;
    top: 50px;
    left: 10px;
    background: rgba(0,0,0,0.8);
    padding: 1rem;
    border-radius: 10px;
    display: none;
    max-width: 300px;
  }
  .toggle {
    display: flex;
    align-items: center;
    margin: 0.5rem 0;
  }
  .toggle input[type="checkbox"] {
    margin-left: auto;
    width: 40px;
    height: 20px;
    -webkit-appearance: none;
    background: #ccc;
    outline: none;
    border-radius: 20px;
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
  }
  .toggle input[type="checkbox"]:checked {
    background: #0f0;
  }
  .toggle input[type="checkbox"]::before {
    content: '';
    position: absolute;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    top: 1px;
    left: 1px;
    background: #fff;
    transition: 0.2s;
  }
  .toggle input[type="checkbox"]:checked::before {
    left: 21px;
  }
</style>
</head>
<body>

<div id="settings">⚙️</div>
<div id="settings-panel">
  <div class="toggle">Music <input type="checkbox" id="music-toggle"></div>
  <div class="toggle">Sound Effects <input type="checkbox" id="sfx-toggle" checked></div>
  <div class="toggle">Offline Earnings <input type="checkbox" id="offline-toggle" checked></div>
  <div>
    <h3>Themes</h3>
    <div id="themes-list"></div>
  </div>
</div>

<div id="game-container">
  <div id="click-area">
    <button id="click-button">✨</button>
  </div>
  <div id="shop">
    <h2>Shop</h2>
    <div class="shop-item" id="upgrade-btn">Upgrade Click (Next: 2)</div>
    <div class="shop-item" id="auto-btn">Buy Auto Clicker</div>
    <div class="shop-item" id="fast-auto-btn">Buy Fast Auto Clicker</div>
    <div class="shop-item" id="rebirth-btn">Rebirth (Next: 2x)</div>
    <div id="coins-display">Coins: 0</div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore-compat.js"></script>

<script>
// ==== FIREBASE CONFIG ====
const firebaseConfig = {
  apiKey: "AIzaSyBVV8RBo2vTXjQqwEpw1z4BtkF2e-k1aBM",
  authDomain: "cosmic-clickers.firebaseapp.com",
  projectId: "cosmic-clickers",
  storageBucket: "cosmic-clickers.firebasestorage.app",
  messagingSenderId: "24680236974",
  appId: "1:24680236974:web:65afbb538c971ed0362a3f",
  measurementId: "G-28BR1L29XH"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ==== UTILITY ====
function usernameToEmail(username) { return `${username.toLowerCase()}@cosmic.local`; }

// ==== GAME STATE ====
let gameState = {
  coins: 0,
  perClick: 1,
  upgrades: 0,
  autos: {normal:0,fast:0},
  rebirths: 0,
  shards: 0,
  prestigeBoost: 1,
  settings: {music:false,sfx:true,offline:true},
  theme: 'default'
};
let username = "";

// ==== SETTINGS TOGGLE ====
document.getElementById("settings").onclick = () => {
  const panel = document.getElementById("settings-panel");
  panel.style.display = panel.style.display==="none"?"block":"none";
}

// ==== CLICK ANIMATION + LOGIC ====
const clickBtn = document.getElementById("click-button");
clickBtn.onclick = () => {
  clickBtn.style.transform = "scale(1.2)";
  setTimeout(()=>clickBtn.style.transform="scale(1)",100);
  gameState.coins += gameState.perClick*gameState.prestigeBoost;
  updateDisplay();
}

// ==== SHOP LOGIC ====
const upgradeBtn = document.getElementById("upgrade-btn");
upgradeBtn.onclick = () => {
  gameState.upgrades += 1;
  gameState.perClick *= 2;
  upgradeBtn.innerText = `Upgrade Click (Next: ${gameState.perClick*2})`;
  updateDisplay();
}

const autoBtn = document.getElementById("auto-btn");
autoBtn.onclick = () => {
  if(gameState.autos.normal===0){
    gameState.autos.normal = 1;
    autoBtn.style.opacity = 0.5;
    autoBtn.style.pointerEvents = "none";
    startAutoClicks(1000);
  }
}

const fastAutoBtn = document.getElementById("fast-auto-btn");
fastAutoBtn.onclick = () => {
  if(gameState.autos.fast===0){
    gameState.autos.fast = 1;
    fastAutoBtn.style.opacity = 0.5;
    fastAutoBtn.style.pointerEvents = "none";
    startAutoClicks(300);
  }
}

const rebirthBtn = document.getElementById("rebirth-btn");
rebirthBtn.onclick = () => {
  gameState.rebirths += 1;
  gameState.prestigeBoost = 2 ** gameState.rebirths;
  gameState.coins = 0;
  gameState.perClick = 2;
  updateDisplay();
  rebirthBtn.innerText = `Rebirth (Next: ${gameState.prestigeBoost*2}x)`;
}

// ==== AUTO CLICKERS ====
function startAutoClicks(interval){
  setInterval(()=>{gameState.coins += gameState.perClick; updateDisplay();}, interval);
}

// ==== DISPLAY ====
function updateDisplay(){
  document.getElementById("coins-display").innerText = `Coins: ${gameState.coins}`;
}

// ==== CLOUD SAVE ====
async function saveGame(){
  if(username==="") return;
  await db.collection("users").doc(username.toLowerCase()).set({gameState: gameState},{merge:true});
}
setInterval(saveGame,10000);

// ==== LOGIN / REGISTER ====
async function loginUser(u,p){
  const email = usernameToEmail(u);
  const cred = await auth.signInWithEmailAndPassword(email,p);
  username = u;
  const doc = await db.collection("users").doc(username.toLowerCase()).get();
  if(doc.exists) gameState = doc.data().gameState;
  updateDisplay();
}

async function registerUser(u,p){
  const docRef = db.collection("users").doc(u.toLowerCase());
  const doc = await docRef.get();
  if(doc.exists){ alert("Username taken"); return; }
  const email = usernameToEmail(u);
  const cred = await auth.createUserWithEmailAndPassword(email,p);
  username = u;
  await docRef.set({gameState:gameState});
  updateDisplay();
}

// ==== INIT ====
updateDisplay();
</script>
</body>
</html>
