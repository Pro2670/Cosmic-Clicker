<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Cosmic Clickers ‚Äî Firebase</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#050b2e; --bg2:#14002e;
  --card:#0b1220; --accent:#7c3aed; --glass:rgba(255,255,255,0.04);
  --muted:rgba(255,255,255,0.6);
}
*{box-sizing:border-box}html,body{height:100%}
body{
  margin:0;font-family:Inter,system-ui;
  background: radial-gradient(1000px 600px at 10% 10%, rgba(124,58,237,.25), transparent),
              radial-gradient(900px 500px at 90% 90%, rgba(59,130,246,.18), transparent),
              linear-gradient(135deg, var(--bg1), var(--bg2));
  color:#e6eef8; display:flex; align-items:center; justify-content:center; padding:12px;
}
.app{width:1100px;max-width:100%;min-height:600px;border-radius:16px;overflow:hidden;display:grid;grid-template-columns:1fr 360px;background:rgba(255,255,255,.03)}
.game{padding:20px;display:flex;flex-direction:column;gap:14px}
.panel{background:var(--card);border-radius:12px;padding:14px}
.header{display:flex;justify-content:space-between;align-items:center}
.title{font-weight:800;font-size:18px}
.sub{color:var(--muted);font-size:12px}
.stats{display:grid;grid-template-columns:repeat(5,1fr);gap:10px} /* added shards */
.stat h3{margin:0;font-size:16px}.stat p{margin:4px 0 0;font-size:11px;color:var(--muted)}
.click-area{display:flex;align-items:center;justify-content:center;flex-direction:column;gap:10px}
.big-button{width:260px;height:100px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:30px;cursor:pointer;user-select:none;background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.01));box-shadow:0 10px 30px rgba(124,58,237,.3)}
.big-button.bounce{animation:bounce .22s ease}
@keyframes bounce{0%{transform:scale(1)}40%{transform:scale(1.1)}100%{transform:scale(1)}}
.shop-panel{padding:14px;border-left:1px solid rgba(255,255,255,.05)}
.shop-list{margin-top:10px;display:flex;flex-direction:column;gap:10px}
.item{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;background:var(--glass)}
.item h4{margin:0;font-size:14px}
.price{font-weight:700}
.buy-btn{background:linear-gradient(90deg,var(--accent),#5b21b6);border:none;padding:8px 12px;color:#fff;border-radius:8px}
.buy-btn:disabled{opacity:.4}
.shop-toggle{position:fixed;left:10px;top:14px;z-index:99}
.shop-toggle button{background:var(--accent);border:none;color:#fff;padding:10px 14px;border-radius:10px}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#0008;padding:10px 14px;border-radius:8px;display:none}
.rebirth-overlay{position:fixed;inset:0;pointer-events:none;opacity:0;background:radial-gradient(circle,rgba(124,58,237,.6),transparent 60%);transition:.4s}
.rebirth-overlay.active{opacity:1}
#settings{position:fixed;top:10px;right:10px;background:var(--accent);padding:6px 10px;border-radius:10px;cursor:pointer;z-index:100}
#settings-panel{position:fixed;top:50px;right:10px;background:rgba(0,0,0,0.85);padding:12px;border-radius:12px;display:none;z-index:100;max-width:220px}
.toggle{display:flex;align-items:center;margin:0.5rem 0}
.toggle input[type="checkbox"]{margin-left:auto;width:40px;height:20px;-webkit-appearance:none;background:#ccc;outline:none;border-radius:20px;position:relative;cursor:pointer;transition:background 0.2s}
.toggle input[type="checkbox"]:checked{background:#0f0}
.toggle input[type="checkbox"]::before{content:'';position:absolute;width:18px;height:18px;border-radius:50%;top:1px;left:1px;background:#fff;transition:0.2s}
.toggle input[type="checkbox"]:checked::before{left:21px}
#login-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.95);display:flex;flex-direction:column;justify-content:center;align-items:center;gap:10px;z-index:200}
#login-overlay input{padding:0.5rem;font-size:1rem;width:200px;border-radius:5px;border:none}
#login-overlay button{padding:0.5rem 1rem;font-size:1rem;border-radius:5px;border:none;background:#ffcc00;color:#000;cursor:pointer}
#login-error{color:red;font-size:12px}
#admin-panel{position:fixed;bottom:10px;left:10px;background:rgba(255,255,255,0.1);padding:12px;border-radius:10px;display:none;flex-direction:column;gap:6px;z-index:150}
#admin-panel input,#admin-panel select{padding:4px;border-radius:4px;border:none}
#admin-panel button{background:#7c3aed;color:#fff;padding:4px 6px;border-radius:6px;border:none;cursor:pointer}
@media (max-width:900px){.app{grid-template-columns:1fr}.shop-panel{border-left:none;border-top:1px solid rgba(255,255,255,.05)}.big-button{width:90%}}
</style>
</head>
<body>

<div class="shop-toggle"><button id="shopToggle">üõí Shop</button></div>
<div class="rebirth-overlay" id="rebirthOverlay"></div>

<!-- SETTINGS BUTTON -->
<div id="settings">‚öôÔ∏è</div>
<div id="settings-panel">
  <div class="toggle">Music <input type="checkbox" id="music-toggle"></div>
  <div class="toggle">SFX <input type="checkbox" id="sfx-toggle" checked></div>
  <div class="toggle">Offline Earnings <input type="checkbox" id="offline-toggle" checked></div>
  <div><strong>Themes</strong><div id="themes-list"></div></div>
</div>

<!-- LOGIN OVERLAY -->
<div id="login-overlay">
  <input type="text" id="login-username" placeholder="Username">
  <input type="password" id="login-password" placeholder="Password">
  <button id="login-btn">Login</button>
  <button id="register-btn">Register</button>
  <div id="login-error"></div>
</div>

<!-- ADMIN PANEL -->
<div id="admin-panel">
  <input type="text" id="admin-user" placeholder="Username">
  <input type="number" id="admin-amount" placeholder="Amount">
  <select id="admin-type">
    <option value="coins">Coins</option>
    <option value="shards">Shards</option>
    <option value="rebirths">Rebirths</option>
  </select>
  <button id="admin-submit">Give</button>
</div>

<div class="app">
  <div class="game">
    <div class="header"><div><div class="title">Cosmic Clickers</div><div class="sub">Click ‚Ä¢ Upgrade ‚Ä¢ Automate ‚Ä¢ Rebirth</div></div></div>
    <div class="panel stats">
      <div class="stat"><h3 id="counter">0</h3><p>Coins</p></div>
      <div class="stat"><h3 id="pcDisplay">1</h3><p>Per Click</p></div>
      <div class="stat"><h3 id="income">0/s</h3><p>Auto</p></div>
      <div class="stat"><h3 id="shards">0</h3><p>Shards</p></div>
      <div class="stat"><h3 id="rebirths">0</h3><p>Rebirths</p></div>
    </div>
    <div class="panel click-area">
      <div class="big-button" id="clickBtn">Tap</div>
      <div class="sub">Earn <strong id="perClickDisplay">1</strong> per tap</div>
    </div>
    <div class="panel footer">
      <div>Upgrades: <span id="upgradesOwned">0</span></div>
      <button id="rebirthBtn" class="buy-btn">Rebirth (Cost: <span id="rebirthCost">1000</span>)</button>
    </div>
  </div>

  <aside class="shop-panel" id="shopPanel">
    <div><strong>Shop</strong></div>
    <div class="shop-list" id="shopList"></div>
    <button id="resetBtn" class="buy-btn" style="margin-top:12px;opacity:.6">Reset Save</button>
  </aside>
</div>

<div id="toast" class="toast"></div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore-compat.js"></script>

<script>
// ====== FIREBASE CONFIG ======
const firebaseConfig = {
  apiKey: "AIzaSyBVV8RBo2vTXjQqwEpw1z4BtkF2e-k1aBM",
  authDomain: "cosmic-clickers.firebaseapp.com",
  projectId: "cosmic-clickers",
  storageBucket: "cosmic-clickers.firebasestorage.app",
  messagingSenderId: "24680236974",
  appId: "1:24680236974:web:65afbb538c971ed0362a3f",
  measurementId: "G-28BR1L29XH"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ====== GAME STATE ======
let username="";
let state={coins:0,perClick:1,upgrades:0,upgradeLevel:0,autos:{normal:0,fast:0},rebirths:0,shards:0};

// ====== ELEMENTS ======
const counterEl=document.getElementById('counter');
const pcDisplay=document.getElementById('perClickDisplay');
const clickBtn=document.getElementById('clickBtn');
const incomeEl=document.getElementById('income');
const shopList=document.getElementById('shopList');
const upgradesOwned=document.getElementById('upgradesOwned');
const rebirthsEl=document.getElementById('rebirths');
const rebirthCostEl=document.getElementById('rebirthCost');
const shardsEl=document.getElementById('shards');
const toast=document.getElementById('toast');
const rebirthBtn=document.getElementById('rebirthBtn');
const resetBtn=document.getElementById('resetBtn');
const shopPanel=document.getElementById('shopPanel');
const shopToggle=document.getElementById('shopToggle');
const rebirthOverlay=document.getElementById('rebirthOverlay');

// ====== SHOP ITEMS ======
const shopItems=[
  {id:'double',name:'Double Upgrade',desc:()=>`Current ${state.perClick} ‚Üí ${state.perClick*2}`,buy(){state.upgrades++;state.perClick*=2;state.upgradeLevel++},cost:()=>Math.floor(50*Math.pow(2.2,state.upgradeLevel))},
  {id:'autoNorm',name:'Normal Auto-Clicker',desc:()=>`1/sec (one-time per rebirth)`,buy(){state.autos.normal=1},cost:()=>100},
  {id:'autoFast',name:'Fast Auto-Clicker',desc:()=>`5/sec (one-time per rebirth)`,buy(){state.autos.fast=1},cost:()=>500}
];

function format(n){if(n>=1e6)return(n/1e6).toFixed(2)+'M';if(n>=1e3)return(n/1e3).toFixed(2)+'K';return Math.floor(n)}

function renderShop(){
  shopList.innerHTML='';
  shopItems.forEach(i=>{
    const owned=(i.id==='autoNorm'&&state.autos.normal)||(i.id==='autoFast'&&state.autos.fast);
    const d=document.createElement('div');d.className='item';
    d.innerHTML=`<div style="flex:1"><h4>${i.name}</h4><div class="sub">${i.desc()}</div></div>
                   <div><div class="price">${format(i.cost())}</div><button class="buy-btn" ${owned?'disabled':''}>${owned?'Owned':'Buy'}</button></div>`;
    d.querySelector('button').onclick=()=>buyItem(i);
    shopList.appendChild(d);
  });
}

// ====== CLICKER LOGIC ======
clickBtn.addEventListener('click',()=>{
  clickBtn.classList.remove('bounce');void clickBtn.offsetWidth;clickBtn.classList.add('bounce');
  state.coins+=state.perClick;
  updateUI();
  save();
});

function buyItem(item){
  const price=item.cost();
  if(state.coins<price){toastMsg('Not enough coins');return;}
  state.coins-=price;item.buy();toastMsg(`Purchased ${item.name}`);
  updateUI(); save();
}

// ====== AUTO CLICKERS ======
let last=Date.now();
setInterval(()=>{
  const now=Date.now(); const d=now-last; last=now;
  if(state.autos.normal)state.coins+=d/1000*state.perClick;
  if(state.autos.fast)state.coins+=d/200*state.perClick;
  updateUI();
},200);

// ====== REBIRTH ======
const BASE_REBIRTH_COST=1000;
const getRebirthCost=()=>BASE_REBIRTH_COST*Math.pow(3,state.rebirths);
rebirthBtn.onclick=()=>{
  const cost=getRebirthCost();
  if(state.coins<cost){toastMsg('Not enough for rebirth');return;}
  state.rebirths++; state.coins=0; state.upgrades=0; state.upgradeLevel=0; state.autos={normal:0,fast:0}; state.perClick=Math.pow(2,state.rebirths);
  rebirthOverlay.classList.add('active'); setTimeout(()=>rebirthOverlay.classList.remove('active'),600);
  toastMsg(`REBIRTH! x${state.perClick} permanent boost`);
  updateUI(); save();
};

// ====== RESET ======
resetBtn.onclick=()=>{if(confirm('Reset all?')){state={coins:0,perClick:1,upgrades:0,upgradeLevel:0,autos:{normal:0,fast:0},rebirths:0,shards:0};updateUI();save();}}

// ====== TOAST ======
function toastMsg(t){toast.textContent=t;toast.style.display='block';clearTimeout(toast._h);toast._h=setTimeout(()=>toast.style.display='none',1200)}

// ====== UI UPDATE ======
function updateUI(){
  counterEl.textContent=format(state.coins);
  pcDisplay.textContent=format(state.perClick);
  incomeEl.textContent=format((state.autos.normal+state.autos.fast*5)*state.perClick)+'/s';
  upgradesOwned.textContent=state.upgrades;
  rebirthsEl.textContent=state.rebirths;
  rebirthCostEl.textContent=format(getRebirthCost());
  shardsEl.textContent=format(state.shards);
  renderShop();
}

// ====== SHOP TOGGLE ======
let open=true;shopToggle.onclick=()=>{open=!open;shopPanel.style.display=open?'block':'none'};
if(innerWidth<900)shopPanel.style.display='none';

// ====== FIREBASE LOGIN / REGISTER ======
const loginOverlay=document.getElementById('login-overlay');
const loginError=document.getElementById('login-error');
document.getElementById('login-btn').onclick=async ()=>{
  const u=document.getElementById('login-username').value.trim();
  const p=document.getElementById('login-password').value;
  if(!u||!p){loginError.innerText="Fill all fields";return;}
  try{
    const email=`${u.toLowerCase()}@cosmic.local`;
    await auth.signInWithEmailAndPassword(email,p);
    username=u;
    const doc=await db.collection('users').doc(username.toLowerCase()).get();
    if(doc.exists)state=doc.data().gameState;
    loginOverlay.style.display='none'; updateUI(); checkAdmin();
  }catch(e){loginError.innerText=e.message;}
};
document.getElementById('register-btn').onclick=async ()=>{
  const u=document.getElementById('login-username').value.trim();
  const p=document.getElementById('login-password').value;
  if
